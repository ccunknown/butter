{"version":3,"sources":["../src/clock_ctrl.js"],"names":["PanelCtrl","moment","panelDefaults","title","butter","butterType","on","method","url","headers","body","off","ClockCtrl","$scope","$injector","_","defaultsDeep","panel","headtxt","butterstate","edmShowButter","edmShowButterOn","edmShowButterOff","edmRequestIndex","events","onInitEditMode","bind","updateButter","init_edmShowButter","addEditorTab","len","length","i","index","console","log","tea","$timeout","bindex","reversebutter","sendRequest","then","JSON","stringify","data","catch","error","cindex","fetch","response","json","templateUrl"],"mappings":"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","file":"clock_ctrl.js","sourcesContent":["import {PanelCtrl} from 'app/plugins/sdk';\nimport moment from 'moment';\nimport './css/toggle-checkbox.css!';\n\nvar panelDefaults = {\n  title: 'Panel Title',\n  butter:[\n    {\n      butterType: 'on/off button',\n      on:[\n        {\n          method: 'PUT',\n          url: `https://httpillwww.mozilla-iot.org/things/http---192.168.43.62-things-lamp1/properties/on`,\n          headers:{\n            'Content-Type': 'application/json',\n            'Accept': 'application/json',\n            'Authorization': 'Bearer eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImVkYWMzMWQzLWUxMjAtNGJiMy04NWQzLTdlNTYwOGNiNjBmMyJ9.eyJjbGllbnRfaWQiOiJsb2NhbC10b2tlbiIsInJvbGUiOiJhY2Nlc3NfdG9rZW4iLCJzY29wZSI6Ii90aGluZ3M6cmVhZHdyaXRlIiwiaWF0IjoxNTM2MjA4MzI5fQ.d1f9-4LE7KJTDr6b04xAynwHdGl_TZCYhQTsurYR4dPH5KFUXLpzwrUrokODzelam8M1EmemB_AYzVNC9dHyCw'\n          },\n          body:'{\"on\":true}'\n        },\n        {\n          method: 'PUT',\n          url: `https://httpillwww.mozilla-iot.org/things/http---192.168.43.62-things-lamp1/properties/level`,\n          headers:{\n            'Content-Type': 'application/json',\n            'Accept': 'application/json',\n            'Authorization': 'Bearer eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImVkYWMzMWQzLWUxMjAtNGJiMy04NWQzLTdlNTYwOGNiNjBmMyJ9.eyJjbGllbnRfaWQiOiJsb2NhbC10b2tlbiIsInJvbGUiOiJhY2Nlc3NfdG9rZW4iLCJzY29wZSI6Ii90aGluZ3M6cmVhZHdyaXRlIiwiaWF0IjoxNTM2MjA4MzI5fQ.d1f9-4LE7KJTDr6b04xAynwHdGl_TZCYhQTsurYR4dPH5KFUXLpzwrUrokODzelam8M1EmemB_AYzVNC9dHyCw'\n          },\n          body:'{\"level\":65}'\n        }\n      ],\n      off:[\n        {\n          method: 'PUT',\n          url: `https://httpillwww.mozilla-iot.org/things/http---192.168.43.62-things-lamp1/properties/on`,\n          headers:{\n            'Content-Type': 'application/json',\n            'Accept': 'application/json',\n            'Authorization': 'Bearer eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImVkYWMzMWQzLWUxMjAtNGJiMy04NWQzLTdlNTYwOGNiNjBmMyJ9.eyJjbGllbnRfaWQiOiJsb2NhbC10b2tlbiIsInJvbGUiOiJhY2Nlc3NfdG9rZW4iLCJzY29wZSI6Ii90aGluZ3M6cmVhZHdyaXRlIiwiaWF0IjoxNTM2MjA4MzI5fQ.d1f9-4LE7KJTDr6b04xAynwHdGl_TZCYhQTsurYR4dPH5KFUXLpzwrUrokODzelam8M1EmemB_AYzVNC9dHyCw'\n          },\n          body:'{\"on\":false}'\n        }\n      ]\n    }\n  ]\n};\n\n\nexport class ClockCtrl extends PanelCtrl {\n\n  constructor($scope, $injector) {\n    super($scope, $injector);\n    _.defaultsDeep(this.panel, panelDefaults);\n    //this.updateClock();\n\n    this.headtxt = \"\";\n    this.butterstate = {};\n    this.edmShowButter = [];\n    this.edmShowButterOn = false;\n    this.edmShowButterOff = false;\n    this.edmRequestIndex = -1;\n    //this.butter();\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    //this.events.on('panel-initialized', this.render.bind(this));\n\n    this.updateButter();\n  }\n\n  onInitEditMode(){\n    this.init_edmShowButter();\n    this.addEditorTab('Options', 'public/plugins/grafana-butter-panel/editor.html', 2);\n  }\n\n  init_edmShowButter(){\n    this.edmShowButter = [];\n    var len = this.panel.butter.length;\n    for(var i = 0;i < len;i++){\n      this.edmShowButter[i] = false;\n    }\n  }\n\n  edmToggleButter(index){\n    this.edmRequestIndex = -1;\n    this.edmShowButterOn = false;\n    this.edmShowButterOff = false;\n    this.edmShowButter[index] = !this.edmShowButter[index];\n    console.log(\"edmToggleButter > \"+this.edmShowButter[index]);\n  }\n\n  edmToggleButterOn(){\n    this.edmRequestIndex = -1;\n    this.edmShowButterOn = !this.edmShowButterOn;\n    console.log(\"edmShowButterOn > \"+this.edmShowButterOn);\n  }\n\n  edmToggleButterOff(){\n    this.edmRequestIndex = -1;\n    this.edmShowButterOff = !this.edmShowButterOff;\n    console.log(\"edmShowButterOff > \"+this.edmShowButterOff);\n  }\n\n  edmToggleRequest(index){\n    if(this.edmRequestIndex == index){\n      this.edmRequestIndex = -1;\n    }\n    else{\n      this.edmRequestIndex = index;\n    }\n    console.log(\"edmRequestIndex > \"+this.edmRequestIndex);\n  }\n\n  updateButter() {\n    this.tea = \"Label : \"+this.headtxt;\n    this.$timeout(() => { this.updateButter(); }, 1000);\n  }\n\n  butter(bindex) {\n  // Default options are marked with *\n    console.log(\"Butter index : \"+bindex);\n\n    var len = 0;\n    if(this.butterstate[bindex])\n      len = this.panel.butter[bindex].on.length;\n    else\n      len = this.panel.butter[bindex].off.length;\n\n    var reversebutter = function(){\n      this.butterstate[bindex] = !this.butterstate[bindex];\n    }\n\n    for(var i=0;  i < len;  i++){\n      this.sendRequest(bindex,i)\n        .then(data => console.log(JSON.stringify(data)))\n        //.catch(error => console.error(error));\n        .catch(function(error){\n          console.error(error);\n          reversebutter();\n        });\n    }\n  }\n\n  sendRequest(bindex, cindex){\n    console.log(\"butterstatus : \"+this.butterstate[bindex]);\n    console.log(\"cindex : \"+cindex);\n    if(this.butterstate[bindex]){\n      console.log(\"In true condition.\");\n      return fetch(this.panel.butter[bindex].on[cindex].url, {\n        method: this.panel.butter[bindex].on[cindex].method, // *GET, POST, PUT, DELETE, etc.\n        headers: this.panel.butter[bindex].on[cindex].headers,\n        body: this.panel.butter[0].on[cindex].body // body data type must match \"Content-Type\" header\n        //body: JSON.stringify(data) // body data type must match \"Content-Type\" header\n      })\n      .then(response => response.json()); // parses response to JSON\n    }\n    else{\n      console.log(\"In false condition.\");\n      return fetch(this.panel.butter[bindex].off[cindex].url, {\n        method: this.panel.butter[bindex].off[cindex].method, // *GET, POST, PUT, DELETE, etc.\n        headers: this.panel.butter[bindex].off[cindex].headers,\n        body: this.panel.butter[0].off[cindex].body // body data type must match \"Content-Type\" header\n      })\n      .then(response => response.json()); // parses response to JSON\n    }\n  }\n}\n\nClockCtrl.templateUrl = 'module.html';\n"]}